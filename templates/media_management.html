{% extends "base.html" %}
{% block title %}Manage {{ media_type|title }}s{% endblock %}
{% block content %}
<h1 class="text-3xl font-bold mb-6 text-gray-900">Manage {{ media_type|title }}s</h1>
<div class="bg-white p-4 rounded-xl shadow-md mb-6 sticky top-0 z-10">
    <input type="text" id="search-input" placeholder="Search by title..." class="w-full px-4 py-2 border-transparent rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 bg-gray-100">
</div>
<div id="loading" class="text-center py-12"><div class="inline-block animate-spin rounded-full h-10 w-10 border-b-2 border-indigo-600"></div></div>
<div id="media-grid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-6 hidden"></div>
<div id="pagination" class="flex justify-center mt-8"></div>
<div id="no-results" class="text-center py-12 hidden"><p class="text-gray-500">No {{ media_type }}s found.</p></div>
<script>
    const mediaType = '{{ media_type }}'; let searchTimeout;
    async function loadMedia(page=1,search=''){document.getElementById('loading').classList.remove('hidden');document.getElementById('media-grid').classList.add('hidden');document.getElementById('pagination').innerHTML='';document.getElementById('no-results').classList.add('hidden');try{const e=await fetch(`/api/media/${mediaType}?page=${page}&search=${encodeURIComponent(search)}`);if(!e.ok)throw new Error("Failed to fetch media.");const t=await e.json();document.getElementById('loading').classList.add('hidden');const d=document.getElementById('media-grid');if(d.innerHTML='',0===t.items.length)return void document.getElementById('no-results').classList.remove('hidden');d.classList.remove('hidden'),t.items.forEach(e=>{d.innerHTML+=`
    <div class="bg-white rounded-lg shadow-md overflow-hidden group transition-all hover:shadow-xl hover:-translate-y-1"><a href="/edit/${mediaType}/${e.tmdb_id}"><div class="relative"><img src="${e.poster||"https://via.placeholder.com/300x450/e5e7eb/9ca3af?text=No+Image"}" alt="${e.title}" class="w-full h-auto object-cover aspect-[2/3]" onerror="this.src='https://via.placeholder.com/300x450/e5e7eb/9ca3af?text=No+Image'"><div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-40 transition-all"></div></div><div class="p-3"><h3 class="font-semibold text-sm truncate" title="${e.title}">${e.title}</h3><p class="text-xs text-gray-500">${e.release_year}</p></div></a></div>`}),renderPagination(t.total,t.page,t.page_size)}catch(e){document.getElementById('loading').innerHTML='<p class="text-red-500">Error loading media.</p>',console.error(e)}}
    function renderPagination(e,t,d){const n=Math.ceil(e/d),o=document.getElementById("pagination");if(n<=1)return;let a="";const i=Math.max(1,t-2),l=Math.min(n,t+2);t>1&&(a+=`<button onclick="loadMedia(${t-1}, document.getElementById('search-input').value)" class="px-3 py-1 border rounded-md text-sm">&laquo;</button>`);for(let e=i;e<=l;e++)a+=`<button onclick="loadMedia(${e}, document.getElementById('search-input').value)" class="px-3 py-1 border rounded-md text-sm font-medium ${e===t?"bg-indigo-600 text-white":"bg-white hover:bg-gray-50"}">${e}</button>`;t<n&&(a+=`<button onclick="loadMedia(${t+1}, document.getElementById('search-input').value)" class="px-3 py-1 border rounded-md text-sm">&raquo;</button>`),o.innerHTML=`<div class="flex space-x-2">${a}</div>`}
    document.getElementById('search-input').addEventListener('input',e=>{clearTimeout(searchTimeout),searchTimeout=setTimeout(()=>loadMedia(1,e.target.value),300)}),document.addEventListener('DOMContentLoaded',()=>loadMedia());
</script>
{% endblock %}
